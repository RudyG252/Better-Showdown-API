
var logFile = "|j|‽Kiyoshii_0\n|j|☆rudyrage1\n|t:|1758829348\n|gametype|singles\n|player|p1|Kiyoshii_0|benga|1147\n|player|p2|rudyrage1|169|1131\n|gen|9\n|tier|[Gen 9] Ubers\n|rated|\n|rule|HP Percentage Mod: HP is shown in percentages\n|rule|Endless Battle Clause: Forcing endless battles is banned\n|rule|Sleep Clause Mod: Limit one foe put to sleep\n|rule|Species Clause: Limit one of each Pokémon\n|rule|OHKO Clause: OHKO moves are banned\n|rule|Evasion Items Clause: Evasion items are banned\n|rule|Evasion Moves Clause: Evasion moves are banned\n|clearpoke\n|poke|p1|Kyogre|\n|poke|p1|Dragonite, M|\n|poke|p1|Polteageist|\n|poke|p1|Ursaluna, M|\n|poke|p1|Metagross|\n|poke|p1|Shaymin-Sky|\n|poke|p2|Ursaluna-Bloodmoon, M|\n|poke|p2|Shaymin-Sky|\n|poke|p2|Koraidon|\n|poke|p2|Ho-Oh|\n|poke|p2|Raging Bolt|\n|poke|p2|Palafin, M|\n|teampreview\n|inactive|Battle timer is ON: inactive players will automatically lose when time's up. (requested by Kiyoshii_0)\n|\n|t:|1758829360\n|teamsize|p1|6\n|teamsize|p2|6\n|start\n|switch|p1a: Polteageist|Polteageist, shiny|100/100\n|switch|p2a: PalieWalie|Palafin, M|100/100\n|turn|1\n|\n|t:|1758829377\n|move|p2a: PalieWalie|Jet Punch|p1a: Polteageist\n|-damage|p1a: Polteageist|51/100\n|-ability|p1a: Polteageist|Weak Armor|boost\n|-unboost|p1a: Polteageist|def|1\n|-boost|p1a: Polteageist|spe|2\n|-enditem|p1a: Polteageist|White Herb\n|-clearnegativeboost|p1a: Polteageist|[silent]\n|move|p1a: Polteageist|Shell Smash|p1a: Polteageist\n|-unboost|p1a: Polteageist|def|1\n|-unboost|p1a: Polteageist|spd|1\n|-boost|p1a: Polteageist|atk|2\n|-boost|p1a: Polteageist|spa|2\n|-boost|p1a: Polteageist|spe|2\n|\n|upkeep\n|turn|2\n|\n|t:|1758829401\n|move|p2a: PalieWalie|Jet Punch|p1a: Polteageist\n|-damage|p1a: Polteageist|0 fnt\n|faint|p1a: Polteageist\n|\n|upkeep\n|\n|t:|1758829407\n|switch|p1a: Shaymin|Shaymin-Sky, shiny|100/100\n|turn|3\n|\n|t:|1758829422\n|detailschange|p2a: PalieWalie|Palafin-Hero, M\n|switch|p2a: ShaymyWamy|Shaymin-Sky|100/100\n|move|p1a: Shaymin|Substitute|p1a: Shaymin\n|-start|p1a: Shaymin|Substitute\n|-damage|p1a: Shaymin|76/100\n|\n|-heal|p1a: Shaymin|82/100|[from] item: Leftovers\n|upkeep\n|turn|4\n|\n|t:|1758829432\n|move|p2a: ShaymyWamy|Air Slash|p1a: Shaymin\n|-supereffective|p1a: Shaymin\n|-crit|p1a: Shaymin\n|-end|p1a: Shaymin|Substitute\n|move|p1a: Shaymin|Air Slash|p2a: ShaymyWamy\n|-supereffective|p2a: ShaymyWamy\n|-damage|p2a: ShaymyWamy|7/100\n|\n|-heal|p1a: Shaymin|88/100|[from] item: Leftovers\n|upkeep\n|turn|5\n|\n|t:|1758829446\n|switch|p1a: Metagross|Metagross, shiny|100/100\n|move|p2a: ShaymyWamy|Air Slash|p1a: Metagross\n|-resisted|p1a: Metagross\n|-damage|p1a: Metagross|83/100\n|\n|upkeep\n|turn|6\n|\n|t:|1758829453\n|move|p1a: Metagross|Bullet Punch|p2a: ShaymyWamy\n|-damage|p2a: ShaymyWamy|0 fnt\n|faint|p2a: ShaymyWamy\n|\n|upkeep\n|\n|t:|1758829465\n|switch|p2a: UrsyWursy|Ursaluna-Bloodmoon, M|100/100\n|turn|7\n|\n|t:|1758829477\n|switch|p1a: Shaymin|Shaymin-Sky, shiny|88/100\n|move|p2a: UrsyWursy|Calm Mind|p2a: UrsyWursy\n|-boost|p2a: UrsyWursy|spa|1\n|-boost|p2a: UrsyWursy|spd|1\n|\n|-heal|p1a: Shaymin|94/100|[from] item: Leftovers\n|upkeep\n|turn|8\n|\n|t:|1758829488\n|move|p1a: Shaymin|Air Slash|p2a: UrsyWursy\n|-damage|p2a: UrsyWursy|71/100\n|cant|p2a: UrsyWursy|flinch\n|\n|-heal|p1a: Shaymin|99/100|[from] item: Leftovers\n|-heal|p2a: UrsyWursy|77/100|[from] item: Leftovers\n|upkeep\n|turn|9\n|\n|t:|1758829498\n|move|p1a: Shaymin|Seed Flare|p2a: UrsyWursy\n|-supereffective|p2a: UrsyWursy\n|-damage|p2a: UrsyWursy|0 fnt\n|faint|p2a: UrsyWursy\n|\n|-heal|p1a: Shaymin|100/100|[from] item: Leftovers\n|upkeep\n|\n|t:|1758829508\n|switch|p2a: KoraiWorai|Koraidon|100/100\n|-weather|SunnyDay|[from] ability: Orichalcum Pulse|[of] p2a: KoraiWorai\n|-activate|p2a: KoraiWorai|Orichalcum Pulse|[source]\n|turn|10\n|\n|t:|1758829526\n|move|p2a: KoraiWorai|Outrage|p1a: Shaymin\n|-damage|p1a: Shaymin|0 fnt\n|faint|p1a: Shaymin\n|\n|-weather|SunnyDay|[upkeep]\n|upkeep\n|\n|t:|1758829534\n|switch|p1a: Metagross|Metagross, shiny|83/100\n|turn|11\n|\n|t:|1758829545\n|move|p2a: KoraiWorai|Outrage|p1a: Metagross|[from] lockedmove\n|-resisted|p1a: Metagross\n|-damage|p1a: Metagross|35/100\n|-start|p2a: KoraiWorai|confusion|[fatigue]\n|move|p1a: Metagross|Agility|p1a: Metagross\n|-boost|p1a: Metagross|spe|2\n|\n|-weather|SunnyDay|[upkeep]\n|upkeep\n|turn|12\n|\n|t:|1758829558\n|-activate|p2a: KoraiWorai|confusion\n|move|p2a: KoraiWorai|Outrage|p1a: Metagross\n|-resisted|p1a: Metagross\n|-damage|p1a: Metagross|0 fnt\n|faint|p1a: Metagross\n|\n|-weather|SunnyDay|[upkeep]\n|upkeep\n|\n|t:|1758829566\n|switch|p1a: Ursaluna|Ursaluna, M, shiny|100/100\n|turn|13\n|\n|t:|1758829577\n|move|p1a: Ursaluna|Protect|p1a: Ursaluna\n|-singleturn|p1a: Ursaluna|Protect\n|-activate|p2a: KoraiWorai|confusion\n|move|p2a: KoraiWorai|Outrage|p1a: Ursaluna|[from] lockedmove\n|-activate|p1a: Ursaluna|move: Protect\n|\n|-weather|SunnyDay|[upkeep]\n|-status|p1a: Ursaluna|brn|[from] item: Flame Orb\n|upkeep\n|turn|14\n|\n|t:|1758829592\n|-activate|p2a: KoraiWorai|confusion\n|-damage|p2a: KoraiWorai|87/100|[from] confusion\n|move|p1a: Ursaluna|Facade|p2a: KoraiWorai\n|-damage|p2a: KoraiWorai|0 fnt\n|faint|p2a: KoraiWorai\n|\n|-weather|none\n|-damage|p1a: Ursaluna|94/100 brn|[from] brn\n|upkeep\n|\n|t:|1758829600\n|switch|p2a: PalieWalie|Palafin-Hero, M|100/100\n|-activate|p2a: PalieWalie|ability: Zero to Hero\n|turn|15\n|\n|t:|1758829617\n|-terastallize|p1a: Ursaluna|Ghost\n|move|p2a: PalieWalie|Ice Punch|p1a: Ursaluna\n|-damage|p1a: Ursaluna|64/100 brn\n|move|p1a: Ursaluna|Facade|p2a: PalieWalie\n|-damage|p2a: PalieWalie|0 fnt\n|faint|p2a: PalieWalie\n|\n|-damage|p1a: Ursaluna|58/100 brn|[from] brn\n|upkeep\n|\n|t:|1758829626\n|switch|p2a: HoeiOei|Ho-Oh|100/100\n|turn|16\n|\n|t:|1758829635\n|move|p2a: HoeiOei|Reflect|p2a: HoeiOei\n|-sidestart|p2: rudyrage1|Reflect\n|move|p1a: Ursaluna|Facade|p2a: HoeiOei\n|-damage|p2a: HoeiOei|52/100\n|\n|-damage|p1a: Ursaluna|52/100 brn|[from] brn\n|upkeep\n|turn|17\n|\n|t:|1758829646\n|move|p2a: HoeiOei|Sacred Fire|p1a: Ursaluna|[miss]\n|-miss|p2a: HoeiOei|p1a: Ursaluna\n|move|p1a: Ursaluna|Facade|p2a: HoeiOei\n|-damage|p2a: HoeiOei|0 fnt\n|faint|p2a: HoeiOei\n|\n|-damage|p1a: Ursaluna|46/100 brn|[from] brn\n|upkeep\n|\n|t:|1758829654\n|switch|p2a: RageWagei|Raging Bolt|100/100\n|turn|18\n|\n|t:|1758829661\n|move|p2a: RageWagei|Dragon Pulse|p1a: Ursaluna\n|-damage|p1a: Ursaluna|0 fnt\n|faint|p1a: Ursaluna\n|\n|upkeep\n|\n|t:|1758829673\n|switch|p1a: Kyogre|Kyogre|100/100\n|-weather|RainDance|[from] ability: Drizzle|[of] p1a: Kyogre\n|turn|19\n|\n|t:|1758829692\n|-terastallize|p2a: RageWagei|Electric\n|move|p2a: RageWagei|Thunderclap|p1a: Kyogre\n|-supereffective|p1a: Kyogre\n|-damage|p1a: Kyogre|23/100\n|move|p1a: Kyogre|Water Spout|p2a: RageWagei\n|-damage|p2a: RageWagei|71/100\n|\n|-weather|RainDance|[upkeep]\n|-heal|p2a: RageWagei|78/100|[from] item: Leftovers\n|upkeep\n|turn|20\n|\n|t:|1758829716\n|move|p1a: Kyogre|Water Spout|p2a: RageWagei\n|-damage|p2a: RageWagei|49/100\n|move|p2a: RageWagei|Thunderbolt|p1a: Kyogre\n|-supereffective|p1a: Kyogre\n|-damage|p1a: Kyogre|0 fnt\n|faint|p1a: Kyogre\n|\n|-weather|RainDance|[upkeep]\n|-heal|p2a: RageWagei|55/100|[from] item: Leftovers\n|upkeep\n|\n|t:|1758829729\n|switch|p1a: Dragonite|Dragonite, M|100/100\n|turn|21\n|\n|t:|1758829746\n|move|p1a: Dragonite|Dragon Dance|p1a: Dragonite\n|-boost|p1a: Dragonite|atk|1\n|-boost|p1a: Dragonite|spe|1\n|move|p2a: RageWagei|Dragon Pulse|p1a: Dragonite\n|-supereffective|p1a: Dragonite\n|-damage|p1a: Dragonite|53/100\n|\n|-weather|RainDance|[upkeep]\n|-heal|p2a: RageWagei|61/100|[from] item: Leftovers\n|upkeep\n|turn|22\n|\n|t:|1758829757\n|move|p2a: RageWagei|Thunderclap|p1a: Dragonite\n|-damage|p1a: Dragonite|3/100\n|move|p1a: Dragonite|Earthquake|p2a: RageWagei\n|-supereffective|p2a: RageWagei\n|-damage|p2a: RageWagei|15/100\n|\n|-weather|RainDance|[upkeep]\n|-heal|p2a: RageWagei|21/100|[from] item: Leftovers\n|upkeep\n|turn|23\n|inactive|rudyrage1 has 120 seconds left.\n|\n|t:|1758829774\n|move|p1a: Dragonite|Extreme Speed|p2a: RageWagei\n|-damage|p2a: RageWagei|0 fnt\n|faint|p2a: RageWagei\n|-end|p2a: RageWagei|Protosynthesis|[silent]\n|\n|win|Kiyoshii_0\n|raw|Kiyoshii_0's rating: 1147 &rarr; \u003Cstrong\u003E1171\u003C/strong\u003E\u003Cbr /\u003E(+24 for winning)\n|raw|rudyrage1's rating: 1131 &rarr; \u003Cstrong\u003E1107\u003C/strong\u003E\u003Cbr /\u003E(-24 for losing)\n|l|‽Kiyoshii_0\n|player|p1|\n"

// returns a 2d array where index 0 contains all of p1's pokemon and index 1 contains p2's pokemon
export function getTeamsFromLog(log) 
{
    let teams = [[],[]];
    let lines = log.split("\n");
    for (let i = 0; i < lines.length; i++) {
        let line = lines[i]
        if (!line.startsWith("|poke|")) {
            continue;
        }
        if (teams[0].length === 6 && teams[1].length === 6) {
            return teams;
        }
        teams[line[7] == 1 ? 0 : 1].push(line.substring(9, line.length - 1));
    }
    return teams;
}

// returns the moves and abilities of all pokemon used by player playerIndex inside log (abilities not finished)
export function getMonSets(log, playerIndex)
{
    let nicknameMap = new Map();
    let lines = log.split("\n")
    let nickNameMap = getNicknameMap(lines, playerIndex);
    let moveArrs = getMoveArrs(lines, nicknameMap, playerIndex);
    let abilityMap = getAbilityMap(lines, nicknameMap, playerIndex);

}

// takes a log and player name and returns the player's index
export function getPlayerIndex(log, name) {
    let lines = log.split("\n");
    for (let i = 0; i < lines.length; i++) {
        lines[i] = lines[i].toLowerCase();
        if (lines[i].startsWith("|player|p1|" + name.toLowerCase())) {
            return 0;
        }
        if (lines[i].startsWith("|player|p2|" + name.toLowerCase())) {
            return 1;
        }
    }
}

// returns a 2d array where each index has the mon's name as the zero index then each used move after that
export function getMoveArrs(lines, nicknameMap, playerIndex)
{ 
    let moveArrs = [];
    nicknameMap.forEach((value, key) => {
        moveArrs.push(getMoveArr(key, value, lines, playerIndex));
    });
    return moveArrs;
}

// returns the abilities of each pokemon in a log for player playerIndex (unfinished)
function getAbilityMap(lines, nicknameMap, playerIndex)
{
    let abilityMap = new Map();
    nicknameMap.forEach((value, key) => {
        
    })
}

// returns an array where the first index is the pokemon's full name and each index after is a used move
function getMoveArr(monNickName, monFullName, lines, playerIndex) {
    let moveArr = [];
    moveArr.push(monFullName);
    for (let i = 0; i < lines.length; i++) {
        let line = lines[i];
        if (!line.startsWith("|move|p" + playerIndex + 'a: ' + monNickName)) {
            continue;
        }
        let sections = line.split('|');
        if (!moveArr.includes(sections[3])) {
            moveArr.push(sections[3]);
        }
    }
    return moveArr;
}
// Returns a map with a pokemons nickname as the key and its full name as the value
function getNicknameMap(lines, playerIndex) {
    let nicknameMap = new Map();
    for (let i = 0; i < lines.length; i++) {
        let line = lines[i]
        if (!line.startsWith("|switch|p" + playerIndex + "a")) {
            continue;
        }
        let sections = line.split('|');
        if (!nicknameMap.has(sections[2].substring(5, sections[2].length))) {
            nicknameMap.set(sections[2].substring(5, sections[2].length), sections[3]);
        }
    }
    return nicknameMap;
}